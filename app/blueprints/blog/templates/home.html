{% extends 'base.html' %}

{% block style %}
    <style>
        .rounded-rect {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 50px -25px black;
        }

        .flex-center {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;

        }

        .flex-center.left {
            left: 0px;
        }

        {#.flex-center.right {#}
        {#    right: 0px;#}
        {# }#}

        .sidebar-content {
            position: absolute;
            width: 95%;
            height: 95%;

        {#font-family: Arial, Helvetica, sans-serif;#}{#font-size: 32px;#}{#color: gray;#}
        }

        .sidebar-toggle {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: x-large;
        {#width: 1.3em;#}{#height: 1.3em;#} overflow: visible;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        {#.sidebar-toggle.left {#}
        {#    right: -1.5em;#}
        {# }#}

        {#.sidebar-toggle.right {#}
        {#    left: -1.5em;#}
        {# }#}

        .sidebar-toggle:hover {
            color: #0aa1cf;
            cursor: pointer;
        }

        .sidebar {
            transition: transform 1s;
            z-index: 1;
            width: 300px;
            height: 100%;
        }

        /*
        The sidebar styling has them "expanded" by default, we use CSS transforms to push them offscreen
        The toggleSidebar() function removes this class from the element in order to expand it.
        */
        .left.collapsed {
            transform: translateX(-295px);
        }

        {#.right.collapsed {#}
        {#    transform: translateX(295px);#}
        {# }#}
    </style>
{% endblock %}

{% block content %}

    <div class="container">
        <div class="row my-4">
            <div class="col-md-12">
                <div class="img-fluid rounded" id="map">
                    <div id="left" class="sidebar flex-center left collapsed">
                        <div class="card rounded-rect flex-center" style="width: 95%; height: 95%;">
                            <div>
                                <div class="sidebar-toggle rounded-rect left" onclick="toggleSidebar('left')">&times</div>
                            </div>

                            <h1>Padella</h1>
                            <img src="https://storage.googleapis.com/cdn.thelondoneconomic.com/wp-content/uploads/2017/09/Padella-Interior.jpg" width="250px">

                            <ul>
                                <li>Description: Delicious pasta food</li>
                                <li>Type: Pasta</li>
                                <li>Price: You could go twice a week ( I sometimes do)</li>
                                <li><a href="https://www.padella.co/#menu">Menu</a></li>
                                <li>Good for: Midweek dinner, solo dining, Truly great pasta</li>
                            </ul>
                            <div id="restaurant_name"></div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="restaurants" role="main" class="container">
        <div class="row">
            <div class="col-md-8 blog-main">
                <h3 class="pb-4 mb-4 font-italic border-bottom">All Restaurants</h3>

                {% for review in reviews %}
                    <div class="blog-post">
                        <h2 class="blog-post-title">{{ review.restaurant.name }}</h2>
                        <p class="blog-post-meta">{{ review.created.strftime('%a %d %b %Y') }} by <a href="#">Alex</a></p>
                        <p>{{ review.restaurant.address }}</p>
                        <p>{{ review.comment }}</p>
                    </div>
                    <hr>
                {% endfor %}

                {#                <nav class="blog-pagination">#}
                {#                    <a class="btn btn-outline-primary" href="#">Older</a>#}
                {#                    <a class="btn btn-outline-secondary disabled" href="#" tabindex="-1" aria-disabled="true">Newer</a>#}
                {#                </nav>#}

            </div>

            <aside class="col-md-4 blog-sidebar">
                <div class="p-4 mb-3 bg-light rounded">
                    <h4 class="font-italic">About</h4>
                    <p class="mb-0">This is a simple page to see my restaurant reviews</p>
                </div>

                {#                <div class="p-4">#}
                {#                    <h4 class="font-italic">Archives</h4>#}
                {#                    <ol class="list-unstyled mb-0">#}
                {#                        <li><a href="#">March 2014</a></li>#}
                {#                    </ol>#}
                {#                </div>#}
                {##}
                {#                <div class="p-4">#}
                {#                    <h4 class="font-italic">Elsewhere</h4>#}
                {#                    <ol class="list-unstyled">#}
                {#                        <li><a href="#">GitHub</a></li>#}
                {##}
                {#                    </ol>#}
                {#                </div>#}
            </aside><!-- /.blog-sidebar -->

        </div><!-- /.row -->

    </main><!-- /.container -->


{% endblock %}


{% block scripts %}
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamFja3dhcmRlbGwiLCJhIjoiY2pmbnAwbnBzMTJleTJ3cWV3Y3ZpdW1ycCJ9.TUxJCX-Ja3h6xsoNh0ENIg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [-0.1303793, 51.5067062],
            zoom: 11.5
        });

        function toggleSidebar(id) {
            var elem = document.getElementById(id);
            var classes = elem.className.split(' ');
            var collapsed = classes.indexOf('collapsed') !== -1;

            var padding = {};

            if (collapsed) {
// Remove the 'collapsed' class from the class list of the element, this sets it back to the expanded state.
                classes.splice(classes.indexOf('collapsed'), 1);

                padding[id] = 300; // In px, matches the width of the sidebars set in .sidebar CSS class
                map.easeTo({
                    padding: padding,
                    duration: 1000 // In ms, CSS transition duration property for the sidebar matches this value
                });
            } else {
                padding[id] = 0;
// Add the 'collapsed' class to the class list of the element
                classes.push('collapsed');

                map.easeTo({
                    padding: padding,
                    duration: 1000
                });
            }

// Update the class list on the element
            elem.className = classes.join(' ');
        }

        function clickRestaurant(id) {
            $.getJSON("{{ url_for('blog.restaurant') }}?id=" + id, function (restaurant) {
                console.log(restaurant)
                $('#restaurant_name').html(restaurant.description)
                toggleSidebar('left')
                map.flyTo({
                    center: [13.1631, 72.5450]
                });
            })
        }

        $.getJSON('{{ url_for("blog.locations") }}', function (data) {
            data.forEach(function (location) {
                {#var popup = new mapboxgl.Popup({offset: 25}).setHTML(#}
                {#    location.description#}
                {#);#}
                // create DOM element for the marker
                var el = document.createElement('div');
                el.innerHTML = "<svg display=\"block\" height=\"41px\" width=\"27px\" viewBox=\"0 0 27 41\"><g fill-rule=\"nonzero\"><g transform=\"translate(3.0, 29.0)\" fill=\"#000000\"><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"10.5\" ry=\"5.25002273\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"10.5\" ry=\"5.25002273\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"9.5\" ry=\"4.77275007\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"8.5\" ry=\"4.29549936\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"7.5\" ry=\"3.81822308\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"6.5\" ry=\"3.34094679\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"5.5\" ry=\"2.86367051\"></ellipse><ellipse opacity=\"0.04\" cx=\"10.5\" cy=\"5.80029008\" rx=\"4.5\" ry=\"2.38636864\"></ellipse></g><g fill=\"#cc080b\"><path d=\"M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z\"></path></g><g opacity=\"0.25\" fill=\"#000000\"><path d=\"M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z\"></path></g><g transform=\"translate(6.0, 7.0)\" fill=\"#FFFFFF\"></g><g transform=\"translate(8.0, 8.0)\"><circle fill=\"#000000\" opacity=\"0.25\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\"></circle><circle fill=\"#FFFFFF\" cx=\"5.5\" cy=\"5.5\" r=\"5.4999962\"></circle></g></g></svg>";
                el.className = 'marker';
                el.id = location.restaurant.id;

                el.addEventListener('click', function () {
                    {#console.log(this)#}
                    clickRestaurant(this.id);
                })


                new mapboxgl.Marker({element: el, color: "#cc080b"})
                    .setLngLat([location.restaurant.latitude, location.restaurant.longitude])
                    {#.setPopup(popup)#}
                    .addTo(map);


                {#marker.getElement().on('click', function () {#}
                {#    clickRestaurant()#}
                {# })#}

                {#marker.addEventListener('click', function () {#}
                {#   toggleSidebar('left')#}
                {# })#}

                {#marker.on('click', function () {#}
                {#    toggleSidebar('left')#}
                {# });#}
            })
        });

        {#map.on('load', function () {#}
        {#    toggleSidebar('left');#}
        {# });#}

        {#map.on('click', '')#}

    </script>
{% endblock %}
