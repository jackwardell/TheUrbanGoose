{% extends 'base.html' %}

{% block content %}

    <div class="container">
        <div class="row my-4">
            <div class="col-md-12">
                <div class="img-fluid rounded" id="map"></div>
            </div>
        </div>
    </div>

    <main id="restaurants" role="main" class="container">
        <div class="row">
            <div class="col-md-8 blog-main">
                <h3 class="pb-4 mb-4 font-italic border-bottom">All Restaurants</h3>

                {% for review in reviews %}
                    <div class="blog-post">
                        <h2 class="blog-post-title">{{ review.restaurant.name }}</h2>
                        <p class="blog-post-meta">{{ review.created.strftime('%a %d %b %Y') }} by <a href="#">Alex</a></p>
                        <p>{{ review.restaurant.address }}</p>
                        <p>{{ review.comment }}</p>
                    </div>
                    <hr>
                {% endfor %}

                {#                <nav class="blog-pagination">#}
                {#                    <a class="btn btn-outline-primary" href="#">Older</a>#}
                {#                    <a class="btn btn-outline-secondary disabled" href="#" tabindex="-1" aria-disabled="true">Newer</a>#}
                {#                </nav>#}

            </div>

            <aside class="col-md-4 blog-sidebar">
                <div class="p-4 mb-3 bg-light rounded">
                    <h4 class="font-italic">About</h4>
                    <p class="mb-0">This is a simple page to see my restaurant reviews</p>
                </div>

{#                <div class="p-4">#}
{#                    <h4 class="font-italic">Archives</h4>#}
{#                    <ol class="list-unstyled mb-0">#}
{#                        <li><a href="#">March 2014</a></li>#}
{#                    </ol>#}
{#                </div>#}
{##}
{#                <div class="p-4">#}
{#                    <h4 class="font-italic">Elsewhere</h4>#}
{#                    <ol class="list-unstyled">#}
{#                        <li><a href="#">GitHub</a></li>#}
{##}
{#                    </ol>#}
{#                </div>#}
            </aside><!-- /.blog-sidebar -->

        </div><!-- /.row -->

    </main><!-- /.container -->


{% endblock %}


{% block scripts %}
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamFja3dhcmRlbGwiLCJhIjoiY2pmbnAwbnBzMTJleTJ3cWV3Y3ZpdW1ycCJ9.TUxJCX-Ja3h6xsoNh0ENIg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [-0.1303793, 51.5067062],
            zoom: 11.5
        });

        $.getJSON('{{ url_for("blog.locations") }}', function (data) {
            data.forEach(function (location) {
                var popup = new mapboxgl.Popup({offset: 25}).setHTML(
                    location.description
                );
                new mapboxgl.Marker({color: "#cc080b"})
                    .setLngLat([location.restaurant.latitude, location.restaurant.longitude])
                    .setPopup(popup)
                    .addTo(map);
            })
        });
    </script>
{% endblock %}
